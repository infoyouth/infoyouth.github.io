{% comment %}
  Code Playground Component
  Usage: {% include code-playground.html language="python" code="your code here" height="500" theme="dark" %}
  
  Parameters:
  - language: required (python, c, cpp, java, go, bash, javascript, etc.)
  - code: required (the code to pre-load)
  - height: optional (default: 500px)
  - theme: optional (default: dark)
  - gradient: optional (default: purple - options: purple, pink, green, orange)
{% endcomment %}

{% assign playground_height = include.height | default: "500" %}
{% assign playground_theme = include.theme | default: "dark" %}
{% assign playground_gradient = include.gradient | default: "purple" %}

{% if playground_gradient == "purple" %}
  {% assign gradient_style = "background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" %}
{% elsif playground_gradient == "pink" %}
  {% assign gradient_style = "background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);" %}
{% elsif playground_gradient == "green" %}
  {% assign gradient_style = "background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);" %}
{% elsif playground_gradient == "orange" %}
  {% assign gradient_style = "background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);" %}
{% else %}
  {% assign gradient_style = "background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" %}
{% endif %}

<details class="code-playground" style="margin: 20px 0; border: 2px solid #3498db; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
  <summary style="{{ gradient_style }} padding: 15px 20px; color: white; font-weight: bold; cursor: pointer; user-select: none;">
    ðŸš€ Try this Live â†’ Click to open interactive {{ include.language | upcase }} playground
  </summary>
  <div style="padding: 0;">
    <iframe 
      class="onecompiler-iframe"
      frameborder="0" 
      width="100%" 
      height="{{ playground_height }}px" 
      src="https://onecompiler.com/embed/{{ include.language }}?hideLanguageSelection=true&hideNew=true&hideTitle=true&theme={{ playground_theme }}&listenToEvents=true"
      data-language="{{ include.language }}"
      data-code="{{ include.code | xml_escape }}">
    </iframe>
  </div>
</details>

<script>
// Load the code playground initializer only once
if (!window.playgroundInitializerLoaded) {
  window.playgroundInitializerLoaded = true;
  
  // Decode HTML entities
  function decodePlaygroundHTML(text) {
    var textarea = document.createElement('textarea');
    textarea.innerHTML = text;
    return textarea.value;
  }
  
  // Initialize playgrounds when DOM is ready
  function initPlaygrounds() {
    var iframes = document.querySelectorAll('.onecompiler-iframe');
    console.log('Initializing ' + iframes.length + ' playground(s)');
    
    iframes.forEach(function(iframe, index) {
      var encodedCode = iframe.getAttribute('data-code');
      var language = iframe.getAttribute('data-language');
      
      if (!encodedCode || !language) {
        console.warn('Playground ' + index + ' missing code or language');
        return;
      }
      
      var code = decodePlaygroundHTML(encodedCode);
      var delay = 1500 + (index * 400);
      
      // Map language to proper file extension
      var fileExtension = language;
      if (language === 'typescript') fileExtension = 'ts';
      else if (language === 'javascript') fileExtension = 'js';
      else if (language === 'cpp') fileExtension = 'cpp';
      
      setTimeout(function() {
        try {
          iframe.contentWindow.postMessage({
            eventType: 'populateCode',
            language: language,
            files: [{
              name: 'main.' + fileExtension,
              content: code
            }]
          }, '*');
          console.log('âœ“ Populated playground ' + index + ' (' + language + ')');
        } catch (e) {
          console.error('âœ— Failed playground ' + index + ':', e);
        }
      }, delay);
    });
  }
  
  // Run on DOM ready and page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initPlaygrounds);
  } else {
    initPlaygrounds();
  }
  window.addEventListener('load', function() {
    setTimeout(initPlaygrounds, 500);
  });
}
</script>
