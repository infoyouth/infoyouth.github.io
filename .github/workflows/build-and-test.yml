name: "ğŸš§ Build and Test Workflow"

on:
  pull_request:
    branches:
      - main
      - master
    types:
      - opened
      - synchronize
      - reopened

permissions:
  contents: read

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        # âœ… Ensures the latest code is checked out

      - name: ğŸ’ Setup Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: 3.3
          bundler-cache: true
        # âœ… Set up the Ruby environment with bundler caching enabled

      - name: ğŸ“¦ Install Dependencies
        run: bundle install
        # âœ… Install required gems for the project

      - name: ğŸ› ï¸ Build Site with Jekyll
        run: bundle exec jekyll build -d "_site"
        # âœ… Build the static site using Jekyll

      - name: ğŸ” Run HTMLProofer
        run: |
          bundle exec htmlproofer _site \
            --disable-external \
            --ignore-urls "/^http:\/\/127.0.0.1/,/^http:\/\/0.0.0.0/,/^http:\/\/localhost/"
        # âœ… Check for broken internal links in the built site

      - name: ğŸ§¹ Lint Ruby Code
        run: |
          chmod +x _plugins/posts-lastmod-hook.rb
          bundle exec rubocop
        # âœ… Ensure Ruby code quality using RuboCop

      - name: ğŸš¨ Notify Discord on Failure
        uses: johnnyhuy/actions-discord-git-webhook@v1.0.1
        with:
          webhook_url: ${{ secrets.DISCORD_WEBHOOK_URL }}
        continue-on-error: true

