name: Manage PR Checkboxes

on:
  workflow_run:
    workflows:
      - Build Test and Deploy
      - Algolia Search Indexing
      - Code Scanning Results
    types:
      - completed

permissions:
  pull-requests: write
  checks: read

jobs:
  update-checkboxes:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout Repository
      - name: Checkout Repository
        uses: actions/checkout@v3

      # Step 2: Detect CI Check Status
      - name: Retrieve CI Check Runs
        uses: peter-evans/retrieve-check-runs@v1
        id: detect-checks
        with:
          check-name: |
            Build Test and Deploy / build
            Build Test and Deploy / deploy
            Algolia Search Indexing / üîç Pre-qualifying Checks
            Algolia Search Indexing / ‚ö° Run Algolia Jekyll Action
            Code scanning results / CodeQL
            CodeQL Advanced / Analyze (ruby)

      # Step 3: Update Checkboxes in PR Description
      - name: Update Checkboxes
        uses: marocchino/checkbox-action@v1
        with:
          list: |
            Build (Skipped or Failed)
            Deploy (Skipped or Failed)
            Pre-qualifying Checks
            Action Execution
            CodeQL (No new alerts)
            CodeQL Advanced (Ruby)
          action: check
          error: 'warn'

      # Optional: Additional Actions for Skipped or Failed Checks
      - name: Handle Skipped/Failed Checks
        if: ${{ steps.detect-checks.outputs.status != 'success' }}
        run: |
          echo "Some checks were skipped or failed. Handle as needed."
